<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>OGRE-Next: What&#39;s new in Ogre-Next 4.0</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="ogre_style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="ogre-logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">OGRE-Next
   &#160;<span id="projectnumber">4.0.0unstable</span>
   </div>
   <div id="projectbrief">Object-Oriented Graphics Rendering Engine</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('_ogre40_changes.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">What's new in Ogre-Next 4.0 </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md57">Threaded Hlms</a></li>
<li class="level1"><a href="#autotoc_md58">Hlms implementations and listeners</a><ul><li class="level2"><a href="#Ogre40Changes_PortingTips">Porting tips (from &lt;= 3.0)</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md59">Compositor Script changes</a></li>
<li class="level1"><a href="#autotoc_md60">New initialization step</a></li>
<li class="level1"><a href="#autotoc_md61">HlmsUnlit changes</a></li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md_manual_Migrating_Ogre4_0_Changes"></a></p>
<h1><a class="anchor" id="autotoc_md57"></a>
Threaded Hlms</h1>
<p>We introduced threaded Hlms shader generation, shader compilation, and PSO compilation.</p>
<p>This is used by the new <code>warm_up</code> compositor pass (see <a class="el" href="class_ogre_1_1_compositor_pass_warm_up.html" title="Implementation of CompositorPass.">Ogre::CompositorPassWarmUp</a> and <a class="el" href="class_ogre_1_1_compositor_pass_warm_up_def.html">Ogre::CompositorPassWarmUpDef</a>), the Hlms Disk Cache, and during regular rendering.</p>
<p>This means that most Hlms operations gained a <code>tid</code> parameter, which contains the thread index in range <code>[0; num_threads)</code>.</p>
<p>Operations done in <a class="el" href="class_ogre_1_1_hlms.html#ad3e82fb2e682366cc721e521ee41d64d" title="Called every frame by the Render Queue to cache the properties needed by this pass.">Ogre::Hlms::preparePassHash</a> and <a class="el" href="class_ogre_1_1_hlms.html#a5b71158453ed0a2411a92ecf767af130" title="Called by the renderable when either it changes the material, or its properties change (e....">Ogre::Hlms::calculateHashFor</a> are single threaded and thus should use <a class="el" href="class_ogre_1_1_hlms.html#a3b41b85c9b51fe6794d25e95bd5ea31f" title="For single-threaded operations.">Ogre::Hlms::kNoTid</a>.</p>
<h1><a class="anchor" id="autotoc_md58"></a>
Hlms implementations and listeners</h1>
<p>Custom Hlms implementations and listeners must update their virtual overload functions to accommodate the <code>tid</code> parameter.</p>
<p>This is explained in detail the new <a class="el" href="_hlms_threading.html">Multithreaded Shader Compilation</a> section.</p>
<h2><a class="anchor" id="Ogre40Changes_PortingTips"></a>
Porting tips (from &lt;= 3.0)</h2>
<p>Watch out for calls to <code>mSetProperties.clear();</code> which now must be changed to either <code>mSetProperties[kNoTid].clear();</code> or <code>mSetProperties[tid].clear();</code>.</p>
<p>The same happens with <code>mSetProperties.empty();</code>.</p>
<p>We strongly recommend you use <code>override</code> C++ keyword to locate the API signatures that have changed (which now require you to add the tid argument).</p>
<p>Once that's done, most Hlms-related compiler errors (if setting <a class="el" href="_hlms_threading.html#HlmsThreading_CMakeOptions">`OGRE_SHADER_COMPILATION_THREADING_MODE = 2`</a>) can be fixed by doing a Find &amp; Replace:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Find:   </th><th class="markdownTableHeadNone">Replace with:    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>setProperty(</code>   </td><td class="markdownTableBodyNone"><code>setProperty( tid,</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>getProperty(</code>   </td><td class="markdownTableBodyNone"><code>getProperty( tid,</code>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>setProperty(</code>   </td><td class="markdownTableBodyNone"><code>setProperty( kNoTid,</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>getProperty(</code>   </td><td class="markdownTableBodyNone"><code>getProperty( kNoTid,</code>   </td></tr>
</table>
<p>You should Find &amp; Replace in that order. If you first find all <code>setProperty(</code> and replace them with <code>setProperty( kNoTid,</code>; you will end up with code that compiles but introduces race conditions and no way to identify them.</p>
<p>However if you first find all <code>setProperty(</code> and replace them with <code>setProperty( tid,</code>, you will end up with code that does not compile wherever <code>kNoTid</code> should be used (still exercise care when replacing <code>tid</code> with <code>kNoTid</code>, make sure to be conscious of it. See <a class="el" href="_hlms_threading.html#HlmsThreading_tidArgument">The tid (Thread ID) argument</a> for details).</p>
<h1><a class="anchor" id="autotoc_md59"></a>
Compositor Script changes</h1>
<p>Added the <code>not_texture</code> keyword. This can improve performance in scenarios where you don't intend to sample from this texture i.e. usually in conjuntion with either the <code>uav</code> or <code>explicit_resolve</code> keywords:</p>
<div class="fragment"><div class="line">compositor_node RenderingNodeMsaa</div>
<div class="line">{</div>
<div class="line">    in 0 rt_renderwindow</div>
<div class="line"> </div>
<div class="line">    texture msaaSurface target_width target_height target_format target_orientation_mode msaa 4 not_texture explicit_resolve</div>
<div class="line"> </div>
<div class="line">    rtv mainRtv</div>
<div class="line">    {</div>
<div class="line">        colour 0 msaaSurface resolve rt_renderwindow</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    target mainRtv</div>
<div class="line">    {</div>
<div class="line">        pass render_scene</div>
<div class="line">        {</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    out 0 rt_renderwindow</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md60"></a>
New initialization step</h1>
<p>If you plan on using Alpha Hashing, we provide both blue and white noise.</p>
<p>But blue noise requires you to call <code>mRoot-&gt;getHlmsManager()-&gt;loadBlueNoise()</code> during start up. <a class="el" href="_particle_system2.html#AlphaHashingBlueNoiseSetup">See its new section in the manual</a> for more information.</p>
<h1><a class="anchor" id="autotoc_md61"></a>
HlmsUnlit changes</h1>
<p><a href="https://github.com/OGRECave/ogre-next/commit/9ee6dd793481b5378e9a68fd445a34435b802e1b">HlmsUnlit now behaves like HlmsPbs</a> when it comes to the use of mReservedTexBufferSlots &amp; mReservedTexSlots.</p>
<p>The variable <code>HlmsUnlit::mSamplerUnitSlotStart</code> was removed and <code>HlmsUnlit::mTexUnitSlotStart</code> is now autocalculated every pass, which means users must not rely on overriding this value.</p>
<p>Users deriving from HlmsUnlit must set mReservedTexBufferSlots &amp; mReservedTexSlots instead, like it is done for HlmsPbs.</p>
<p>See <a href="https://github.com/darksylinc/colibrigui/commit/87e74824973007ee9f7f3f46719d2a6ba4948678">Colibri project's commit</a> for an example of how the change was ported. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="manual.html">Manual</a></li><li class="navelem"><a class="el" href="_migrating_series.html">Migrating Series</a></li><li class="navelem"><a class="el" href="_migrating_30_to_40.html">Migrating from 3.0 to 4.0</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
